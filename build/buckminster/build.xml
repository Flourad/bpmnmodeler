<?xml version="1.0" encoding="UTF-8"?>

<project name="STP Generic Component Build" basedir="." default="help">

  <property file="platform.properties"/>
  <property file="project.properties"/>
  <property file="buckminster.properties"/>

  <import file="buckminster.xml" />


	  <target name="build" depends="clean.workspace, buckminster.headless.setup, buckminster.setup.preferences, project.resolve, project.build">

	  </target>

	  <target name="build.site">
	    <echo message=".... building ${project.name} update site"/>
	    <buckminster command="org.eclipse.buckminster.core.perform">
	      <args>
	        <arg value="-Dbuckminster.output.root=${buckminster.build.update.site.dir}"/>
	        <arg value="${buckminster.build.update.site.action}"/>
	      </args>
	    </buckminster>
            <move todir="${base.directory}" flatten="true">
              <fileset dir="${buckminster.build.update.site.dir}">
                <include name="**/${project.name}.archivedsite*.zip" />
              </fileset>
            </move>
	    <echo>
	      Archived ${project.name} update site is available in ${base.directory}
	    </echo>
	  </target>

	  <target name="project.build">
	    <echo message=".... building ${project.name}"/>
	    <buckminster command="org.eclipse.buckminster.core.build"/>
	  </target>

	  <target name="project.test">
	    <echo message=".... testing ${project.name}"/>
            <!-- 
		copy the platform directory and all it's contents to test dir
   		unzip the generated archive site into that test dir - platform is now complete
   		kick off eclipse ant runner instructing it to look at the test.xml file
            -->
            <echo message="THIS TARGET NOT IMPLEMENTED" />
	  </target>

	  <target name="project.resolve">
	    <echo message=".... resolve for ${project.name} components"/>
	    <buckminster command="org.eclipse.buckminster.core.resolve">
	      <args>
	        <arg value="${project.cquery.file}"/>
	      </args>
	    </buckminster>
	  </target>

	  <target name="project.clean">
	    <echo message=".... clean ${project.name} components"/>
	    <buckminster command="org.eclipse.buckminster.core.clean"/>
	  </target>

	  <target name="clean.workspace">
	    <delete dir="${buckminster.workspace}"/>
	  </target>

	  <target name="clean">
	    <delete dir="${buckminster.working.dir}"/>
	  </target>

	  <target name="help">
	    <echo>
	      Before running build target, you must setup a target Eclipse platform which include all dependencies of ${project-name}, this is needed by Buckminster for materialization, refer ${project-name}.rmap for details.

	      Check project.properties, platform.properties and buckminster.properties for changeable properties for your local build, e.g.

	      $ant -Dbase.directory=/local/playground -Dbuckminster.log.level=DEBUG -Dpde.target.arch=x86 -Dpde.target.os=linux -Dpde.target.ws=gtk build
	    </echo>
	  </target>

	</project>
